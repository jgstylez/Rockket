name = "rockket"
main = "src/index.ts"
compatibility_date = "2024-01-15"
compatibility_flags = ["nodejs_compat"]

[env.production]
name = "rockket-prod"

[env.staging]
name = "rockket-staging"

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "rockket-db"
database_id = "your-database-id"
migrations_dir = "migrations"

# KV Namespaces
[[kv_namespaces]]
binding = "CACHE"
id = "your-kv-namespace-id"
preview_id = "your-preview-kv-namespace-id"

# R2 Buckets
[[r2_buckets]]
binding = "STORAGE"
bucket_name = "rockket-storage"
preview_bucket_name = "rockket-storage-preview"

# Durable Objects
[[durable_objects.bindings]]
name = "CODE_GENERATOR"
class_name = "CodeGeneratorAgent"

[[durable_objects.bindings]]
name = "SESSION_MANAGER"
class_name = "SessionManager"

[[durable_objects.bindings]]
name = "AI_AGENT"
class_name = "AIAgent"

# AI Gateway
[ai]
binding = "AI"

# Environment Variables
[vars]
NODE_ENV = "production"
ENABLE_MONITORING = "true"
ENABLE_ANALYTICS = "true"
ENABLE_PERFORMANCE_TRACKING = "true"

# Secrets (set via wrangler secret put)
# ANTHROPIC_API_KEY
# OPENAI_API_KEY
# GOOGLE_AI_STUDIO_API_KEY
# JWT_SECRET
# SENTRY_DSN
# POSTHOG_KEY
# SENDGRID_API_KEY

# Build Configuration
[build]
command = "npm run build"

# Routes
routes = [
  { pattern = "rockket.dev/*", zone_name = "rockket.dev" },
  { pattern = "*.rockket.dev/*", zone_name = "rockket.dev" }
]

# Cron Triggers
[[triggers]]
crons = ["0 0 * * *"]  # Daily cleanup

# Queue
[[queues]]
binding = "TASK_QUEUE"
queue = "rockket-tasks"

# Service Bindings
[[services]]
binding = "AUTH_SERVICE"
service = "rockket-auth"
environment = "production"

[[services]]
binding = "ANALYTICS_SERVICE"
service = "rockket-analytics"
environment = "production"
